#!/usr/bin/python3


import argparse
import os
import sys


if os.environ.get('PIPENV_ACTIVE', '0') == '1':
    parent = os.path.dirname(os.path.dirname(__file__))

    if os.path.exists(os.path.join(parent, 'Pipfile')):
        # Running in a venv from a development tree
        sys.path.insert(0, parent)

from azafea.cli import parse_args
from azafea.config import Config, InvalidConfigurationError
from azafea.controller import Controller


args = parse_args(sys.argv[1:])

try:
    config = Config.from_file(args.config)

except InvalidConfigurationError as e:
    sys.exit(str(e))

if args.print_config:
    print(config)
    sys.exit(0)

controller = Controller(config)
controller.main()
